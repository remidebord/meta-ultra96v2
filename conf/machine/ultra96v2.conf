#@TYPE: Machine
#@NAME: ultra96v2
#@DESCRIPTION: Machine support for Ultra96v2.
#

MACHINEOVERRIDES = "ultra96:ultra96-zynqmp:u96v2-sbc:u96v2-sbc-base:${MACHINE}"
HDF_MACHINE = "u96v2-sbc-base"

require conf/machine/include/soc-zynqmp.inc
require conf/machine/include/machine-xilinx-default.inc

MACHINE_FEATURES += "rtc ext2 ext3 vfat usbhost usbgadget wifi bluetooth"

UBOOT_MACHINE = "xilinx_zynqmp_virt_defconfig"
# prevent U-Boot from deploying the boot.bin
SPL_BINARY = ""

SERIAL_CONSOLES ?= "115200;ttyPS0"

PMU_FIRMWARE_IMAGE_NAME ?= "pmu-firmware-zynqmp-pmu"
PMU_FIRMWARE_DEPLOY_DIR ?= "${TOPDIR}/pmutmp/deploy/images/zynqmp-pmu"

EXTRA_IMAGEDEPENDS += " \
			arm-trusted-firmware \
			virtual/bootloader \
			u-boot-xlnx-scr \
			virtual/fsbl \
			virtual/pmu-firmware \
			virtual/boot-bin \
			"

MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS += "linux-firmware-wl18xx"

EXTRA_IMAGEDEPENDS:remove = "qemu-devicetrees"

# Hardware design
HDF_BASE = "file://" 
HDF_PATH = "u96v2_sbc_base.xsa"

# Add WiFi/Bluetooth/Ethernet related softwares/drivers
DISTRO_FEATURES:append = " bluez5 dbus"
IMAGE_INSTALL:append = " bluez5 \
			 wilc3000-fw \
			 wilc \
			 iw \
			 usb-gadget-ethernet \
			 ethtool \
			 net-tools \
			 "

# SSH server
EXTRA_IMAGE_FEATURES:append = " ssh-server-openssh"
IMAGE_INSTALL:append = " openssh-sftp openssh-sftp-server"

# Misc
IMAGE_INSTALL:append = " libftdi \
			 devmem2 \
			 util-linux-lsblk \
			 vim \
			 python3 \
			 binutils \
			 ldd \
			 "
